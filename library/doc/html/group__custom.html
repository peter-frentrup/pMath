<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>pMath: Custom Objects</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Custom Objects</h1>Encapsulate arbitrary data in pMath objects.  
<a href="#_details">More...</a>
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpmath__custom__t.html">pmath_custom_t</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The Custom Object class.  <a href="classpmath__custom__t.html#_details">More...</a><br></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">PMATH_API <a class="el" href="classpmath__custom__t.html">pmath_custom_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__custom.html#g2ffdd4054c43b543bed1e5238ab7342c">pmath_custom_t::pmath_custom_new</a> (void *data, <a class="el" href="group__general__types.html#ge1a454657f18f3cc54508adeccccbcbc">pmath_callback_t</a> destructor)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create a custom object.  <a href="#g2ffdd4054c43b543bed1e5238ab7342c"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">PMATH_API void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__custom.html#ge7902883fc5e8f88b60410950564fdcd">pmath_custom_t::pmath_custom_get_data</a> (<a class="el" href="classpmath__custom__t.html">pmath_custom_t</a> custom)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get a custom object's data member.  <a href="#ge7902883fc5e8f88b60410950564fdcd"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">PMATH_API <a class="el" href="group__general__types.html#gc92090cb0b56345d6c379ed2341d4ef4">pmath_bool_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__custom.html#g0847bc90fa81ddfdf0f3ff84d32947cf">pmath_custom_t::pmath_custom_has_destructor</a> (<a class="el" href="classpmath__custom__t.html">pmath_custom_t</a> custom, <a class="el" href="group__general__types.html#ge1a454657f18f3cc54508adeccccbcbc">pmath_callback_t</a> dtor)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get a custom object's data destructor.  <a href="#g0847bc90fa81ddfdf0f3ff84d32947cf"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Encapsulate arbitrary data in pMath objects. 
<p>
Custom Objects consist of a pointer and a destructor. The destructor is called (with the pointer as its argument) when the custom object's reference pointer yields zero.<p>
Custom Objects are not evaluateable. This means evaluation of such an object returns NULL. But you can store custom objects in symbols (directly with <a class="el" href="group__symbols.html#g8344005c16b86be82d2efdedb0795a0c" title="Set a symbol&#39;s value.">pmath_symbol_set_value()</a>).<p>
A symbol that holds a custom object remains unevaluated. It can also contain function definitions. But those must be set <em>after</em> setting the value with pmath_symbol_set_value(my_symbol, my_custom_object):<p>
Example: You want to store a custom object and a function definition in a symbol (my_symbol/: answer(my_symbol):= 42). <div class="fragment"><pre class="fragment"><a class="code" href="classpmath__custom__t.html" title="The Custom Object class.">pmath_custom_t</a> my_custom_object = <a class="code" href="group__custom.html#g2ffdd4054c43b543bed1e5238ab7342c" title="Create a custom object.">pmath_custom_new</a>(my_data, my_destructor);
<a class="code" href="group__symbols.html#g8344005c16b86be82d2efdedb0795a0c" title="Set a symbol&amp;#39;s value.">pmath_symbol_set_value</a>(my_symbol, my_custom_object);

<a class="code" href="classpmath__t.html#54e905402c38940687033b87eb8c6c9f" title="Decrements the reference counter of an object and frees its memory if the reference...">pmath_unref</a>(<a class="code" href="classpmath__t.html#d95c86ef0de178de4d3560518c8a8157" title="Evaluate an object.">pmath_evaluate</a>(
  <a class="code" href="group__parser.html#g30c73f2fbcd116125cb5befd26b35ec4" title="Parse a string to an expression.">pmath_parse_string</a>(<span class="stringliteral">"`1`/: answer(`1`):= 42"</span>, 1, <a class="code" href="classpmath__t.html#42cd678b691046a58dede518315c6b13" title="Increments the reference counter of an object and returns it.">pmath_ref</a>(my_symbol))));
</pre></div> <hr><h2>Function Documentation</h2>
<a class="anchor" name="g2ffdd4054c43b543bed1e5238ab7342c"></a><!-- doxytag: member="pmath_custom_t::pmath_custom_new" ref="g2ffdd4054c43b543bed1e5238ab7342c" args="(void *data, pmath_callback_t destructor)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PMATH_API <a class="el" href="classpmath__custom__t.html">pmath_custom_t</a> pmath_custom_new           </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__general__types.html#ge1a454657f18f3cc54508adeccccbcbc">pmath_callback_t</a>&nbsp;</td>
          <td class="paramname"> <em>destructor</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Create a custom object. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>An arbitrary pointer. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>destructor</em>&nbsp;</td><td>A function that will be called on object destruction to enable freeing of <em>data</em>. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>A custom object or NULL on failure (in that case, <em>destructor(data)</em> is called immediately). </dd></dl>

</div>
</div><p>
<a class="anchor" name="ge7902883fc5e8f88b60410950564fdcd"></a><!-- doxytag: member="pmath_custom_t::pmath_custom_get_data" ref="ge7902883fc5e8f88b60410950564fdcd" args="(pmath_custom_t custom)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PMATH_API void * pmath_custom_get_data           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classpmath__custom__t.html">pmath_custom_t</a>&nbsp;</td>
          <td class="paramname"> <em>custom</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Get a custom object's data member. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>custom</em>&nbsp;</td><td>A custom object. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>The objects data member or NULL if <em>custom</em> is NULL.</dd></dl>
Note that you cannot assume anything about the content of this pointer unless you know its destructor (check <a class="el" href="group__custom.html#g0847bc90fa81ddfdf0f3ff84d32947cf">pmath_custom_has_destructor</a> ).<p>
All access to *data must be threadsafe/synchronized. By convention, you are the onlyx one who moves custom objects with your destructor around (other modules should not handle custom objects, whose destructor they do not know). And normally, each of your custom objects are stored in one symbols. So synchronization can be done with <a class="el" href="group__symbols.html#g95b141d9cb33fba80d6a807f304ee3b7" title="Execute a function synchronized to a symbol.">pmath_symbol_synchronized()</a>. If one of these conditions is not met and a custom object could be accessd from multiple threads ( <a class="el" href="group__threads.html">Multithreading with pMath</a> ), you must also store a synchronization object (e.g. symbol or threadlock) in the <em>data</em> member und use this. 
</div>
</div><p>
<a class="anchor" name="g0847bc90fa81ddfdf0f3ff84d32947cf"></a><!-- doxytag: member="pmath_custom_t::pmath_custom_has_destructor" ref="g0847bc90fa81ddfdf0f3ff84d32947cf" args="(pmath_custom_t custom, pmath_callback_t dtor)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PMATH_API <a class="el" href="group__general__types.html#gc92090cb0b56345d6c379ed2341d4ef4">pmath_bool_t</a> pmath_custom_has_destructor           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classpmath__custom__t.html">pmath_custom_t</a>&nbsp;</td>
          <td class="paramname"> <em>custom</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__general__types.html#ge1a454657f18f3cc54508adeccccbcbc">pmath_callback_t</a>&nbsp;</td>
          <td class="paramname"> <em>dtor</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Get a custom object's data destructor. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>custom</em>&nbsp;</td><td>A custom object. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dtor</em>&nbsp;</td><td>A callback function. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>TRUE if the object's destructor is <em>dtor</em>. </dd></dl>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Sun Oct 17 19:31:02 2010 for pMath by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.9 </small></address>
</body>
</html>
